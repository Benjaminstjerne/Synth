<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Intuitiv Web Synth</title>
<style>
  body, html {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: #000;
  }
  canvas {
    display: block;
  }
</style>
</head>
<body>

<script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>
<script>
  let audioContext = new (window.AudioContext || window.webkitAudioContext)();
  let started = false;

  // Opret Web Audio nodes
  const masterGain = audioContext.createGain();
  masterGain.gain.value = 0.4;
  masterGain.connect(audioContext.destination);

  const filterNode = audioContext.createBiquadFilter();
  filterNode.type = "lowpass";
  filterNode.frequency.value = 1000;
  filterNode.Q.value = 1;
  filterNode.connect(masterGain);

  let envelopeGain = audioContext.createGain();
  envelopeGain.gain.value = 0;
  envelopeGain.connect(filterNode);

  let osc = audioContext.createOscillator();
  osc.type = "sine";
  osc.frequency.value = 220; 
  osc.connect(envelopeGain);

  // Simpel ADSR-lignende init (hurtig fade in)
  function triggerSound() {
    const now = audioContext.currentTime;
    envelopeGain.gain.cancelScheduledValues(now);
    envelopeGain.gain.setValueAtTime(0, now);
    envelopeGain.gain.linearRampToValueAtTime(1, now + 0.5);
  }

  // Start oscillator (men lyden aktiveres f√∏rst ved resume)
  osc.start();

  // THREE.js setup
  let scene = new THREE.Scene();
  let camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 100);
  camera.position.z = 3;

  let renderer = new THREE.WebGLRenderer({antialias: true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Lys
  let light = new THREE.DirectionalLight(0xffffff, 0.8);
  light.position.set(1,1,1).normalize();
  scene.add(light);

  let ambientLight = new THREE.AmbientLight(0x404040, 0.5);
  scene.add(ambientLight);

  // Geometri og materiale
  let geometry = new THREE.SphereGeometry(1, 64, 64);
  let material = new THREE.MeshStandardMaterial({ 
    color: 0x7744ff, 
    metalness: 0.2, 
    roughness: 0.5 
  });

  let mesh = new THREE.Mesh(geometry, material);
  scene.add(mesh);

  // Variabler til interaktion
  let mouseX = 0;
  let mouseY = 0;
  let isPointerDown = false;
  let baseFreq = 220;
  let maxFreq = 880;
  let minCutoff = 200;
  let maxCutoff = 5000;

  function onPointerMove(event) {
    if(!started) return;
    let x = event.touches ? event.touches[0].clientX : event.clientX;
    let y = event.touches ? event.touches[0].clientY : event.clientY;

    // Normaliser mouse coords til [0,1]
    let nx = x / window.innerWidth;
